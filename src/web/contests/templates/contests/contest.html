{% extends '_layout.html' %}

{% load markdown_deux_tags %}
{% load humanize %}

{% block title %}{{ contest.name }}{% endblock %}

{% block content %}
    <div class="page contest-page">
        {% include 'contests/_contest_header.html' with contest=contest %}

        <div class="row">
            <div class="col-sm-6">
                {{ contest.description|markdown|urlize }}

                <div class="contest__news-list">
                    {% for one_news in news %}
                        <div class="contest__news">
                            <h3 class="fw300">
                                <a href="{% url 'contests:news' contest.id one_news.id %}">{{ one_news.title }}</a>
                                <div class="text-xs-small fw300" title="{{ one_news.publish_time }}">{{ one_news.publish_time|naturaltime }}</div>
                            </h3>

                            <div class="contest__news__text ellipsis" style="max-height: 150px">
                                {{ one_news.text|markdown|urlize|truncatechars_html:1000 }}
                            </div>
                        </div>
                    {% endfor %}

                    {% if user.is_staff %}
                        <a href="{% url 'contests:add_news' contest.id %}" class="contest__add-news">
                            + Add news
                        </a>
                    {% endif %}
                </div>

            </div>

            <div class="col-sm-6">
                <div>
                    {% if contest.is_team %}
                        <h3>Registered teams</h3>
                        {% for participant in participants %}
                            <div>
                                {{ forloop.counter }}. <a href="{{ participant.team.get_absolute_url }}">{{ participant.team.name }}</a>
                            </div>
                        {% empty %}
                            No teams{% if contest.can_register_now %} a while, <a href="{% url 'contests:join' contest.id %}">be the first</a>!{% endif %}
                        {% endfor %}
                    {% else %}
                        <h3>Participants</h3>
                        {% for participant in participants %}
                            <div>
                                {{ forloop.counter }}. <a href="{{ participant.user.get_absolute_url }}">{{ participant.user.get_full_name }}</a>
                                aka <strong>{{ participant.user.username }}</strong>
                            </div>
                        {% empty %}
                            No participants{% if contest.can_register_now %} a while, <a href="{% url 'contests:join' contest.id %}">be the first</a>! {% endif %}
                        {% endfor %}
                    {% endif %}
                </div>
            </div>

        </div>
    </div>
{% endblock %}