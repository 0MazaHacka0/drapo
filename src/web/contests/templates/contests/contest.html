{% extends '_layout.html' %}

{% load markdown_deux_tags %}

{% block title %}{{ contest.name }}{% endblock %}

{% block content %}
    <div class="page contest-page">
        {% include 'contests/_contest_header.html' with contest=contest %}

        <div>
            {% if is_current_user_participating %}
                {% if current_user_participant.is_approved %}
                    You are registered to the contest
                {% else %}
                    You are waiting for approving by organizers
                {% endif %}
                {% if contest.is_team %}
                    as a <a href="{{ current_user_team.get_absolute_url }}">{{ current_user_team.name }}</a>'s member
                {% endif %}
            {% else %}
                {% if contest.can_register_now %}
                    {% if contest.is_team %}
                        You can <a href="{% url 'contests:join' contest.id %}" class="btn btn-success">register your team</a>
                        or <a href="{% url 'contests:join' contest.id %}" class="btn btn-success">join some one</a>
                    {% else %}
                        <a href=""
                           class="post-link  btn btn-success btn-lg"
                           data-url="{% url 'contests:join' contest.id %}">
                            Join the contest
                        </a>
                    {% endif %}
                {% elif contest.can_register_in_future %}
                    Registration will open {{ contest.registration_start_time }}
                {% else %}
                    Sorry, registration is closed already.
                {% endif %}
            {% endif %}
        </div>

        {{ contest.description|markdown|urlize }}

        <hr />

        <div>
            {% if contest.is_team %}
                <h3>Registered teams</h3>
                {% for participant in participants %}
                    {{ forloop.counter }}. <a href="{{ participant.team.get_absolute_url }}">{{ participant.team.name }}</a>
                {% empty %}
                    No teams{% if contest.can_register_now %} a while, <a href="{% url 'contests:join' contest.id %}">be the first</a>!{% endif %}
                {% endfor %}
            {% else %}
                <h3>Participants</h3>
                {% for participant in participants %}
                    <div>
                        {{ forloop.counter }}. <a href="{{ participant.user.get_absolute_url }}">{{ participant.user.get_full_name }}</a>
                        aka <strong>{{ participant.user.username }}</strong>
                    </div>
                {% empty %}
                    No participants{% if contest.can_register_now %} a while, <a href="{% url 'contests:join' contest.id %}">be the first</a>! {% endif %}
                {% endfor %}
            {% endif %}
        </div>
    </div>
{% endblock %}