{% extends '_layout.html' %}

{% load markdown_deux_tags %}

{% block title %}{{ contest.name }}{% endblock %}

{% block content %}
    <div class="page contest-page">
        {% include 'contests/_contest_header.html' with contest=contest %}

        <div>
            {% if is_current_user_participating %}
                {% if current_user_participant.is_approved %}
                    You are registered to the contest
                {% else %}
                    You are waiting for approving by organizers
                {% endif %}
                {% if contest.is_team %}
                    as a <a href="{{ current_user_team.get_absolute_url }}">{{ current_user_team.name }}</a>'s member
                {% endif %}
            {% else %}
                {% if contest.can_register_now %}
                    {% if not user.is_authenticated %}
                        <a href="{% url 'users:login' %}?next={{ request.path }}">Login</a>
                        or
                        <a href="{% url 'users:register' %}?next={{ request.path }}">register</a>
                        to join the contest
                    {% elif contest.is_team %}
                        You can <a href="{% url 'contests:join' contest.id %}" class="btn btn-primary btn-inline">register your team</a>
                        or <a href="{% url 'contests:join' contest.id %}" class="btn btn-primary btn-inline">join some one</a>
                    {% else %}
                        <a href=""
                           class="post-link  btn btn-success btn-lg"
                           data-url="{% url 'contests:join' contest.id %}">
                            Register to the contest
                        </a>
                    {% endif %}
                {% elif contest.can_register_in_future %}
                    Registration will open {{ contest.registration_start_time }}
                {% else %}
                    Sorry, registration to the contest is closed already.
                {% endif %}
            {% endif %}
        </div>

        <div class="row">
            <div class="col-sm-6">
                {{ contest.description|markdown|urlize }}

                <div class="contest__news">
                    {% for one_news in news %}
                        <hr />

                        <h3 class="fw300">
                            <a href="">{{ one_news.title }}</a>
                            <a href="" class="post-link btn btn-primary btn-xs btn-inline" data-url="">
                                {{ one_news.is_published|yesno:'Hide,Publish' }}
                            </a>
                            <div class="text-xs-small fw300">{{ one_news.publish_time }}</div>
                        </h3>

                        <div class="contest__news__text ellipsis" style="max-height: 150px">
                            {{ one_news.text|markdown|urlize|truncatechars_html:1000 }}
                        </div>

                    {% endfor %}
                </div>

            </div>

            <div class="col-sm-6">
                <div>
                    {% if contest.is_team %}
                        <h3>Registered teams</h3>
                        {% for participant in participants %}
                            <div>
                                {{ forloop.counter }}. <a href="{{ participant.team.get_absolute_url }}">{{ participant.team.name }}</a>
                            </div>
                        {% empty %}
                            No teams{% if contest.can_register_now %} a while, <a href="{% url 'contests:join' contest.id %}">be the first</a>!{% endif %}
                        {% endfor %}
                    {% else %}
                        <h3>Participants</h3>
                        {% for participant in participants %}
                            <div>
                                {{ forloop.counter }}. <a href="{{ participant.user.get_absolute_url }}">{{ participant.user.get_full_name }}</a>
                                aka <strong>{{ participant.user.username }}</strong>
                            </div>
                        {% empty %}
                            No participants{% if contest.can_register_now %} a while, <a href="{% url 'contests:join' contest.id %}">be the first</a>! {% endif %}
                        {% endfor %}
                    {% endif %}
                </div>
            </div>

        </div>
    </div>
{% endblock %}